<breadcrumbs>
  <span>НП</span> > <b>Навчальні плани спеціалізацій</b>
</breadcrumbs>

<div class="container-fluid content">

  <div class="row">
    <div class="col-md-12">
      <div>
        <h1>НП спеціалізацій</h1>
      </div>
    </div>

    <div id="filter" class="col-md-4 margin_top_15 filter__padding" ng-show="showFilter">
      <div class="faculty-select">
        <label for="faculty" class="select-form__label">Факультет</label>
        <ui-select id="faculty" class="select-form__select_attest" ng-model="faculties.selected"
                   append-to-body="true"
                   on-select="filterSubdivision(fullSubdivisionResponse, faculties.selected.id);">
          <ui-select-match placeholder="Оберіть факультет">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="faculty in (faculties | filter: $select.search) track by faculty.id"
                             position="down">
            <span ng-bind="faculty.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Факультет не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorFaculties" class="error-np-messages">
          {{errorFaculties}}
        </div>
      </div>
      <div class="subdivision-select">
        <label for="subdivision" class="select-form__label">Кафедра</label>
        <ui-select id="subdivision" class="select-form__select_attest" ng-model="subdivisions.selected"
                   append-to-body="true"
                   on-select="loadSpecialities(subdivisions.selected.id)">
          <ui-select-match placeholder="Оберіть кафедру">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="subdivision in (subdivisions | filter: $select.search) track by subdivision.id"
                             position="down">
            <span ng-bind="subdivision.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Кафедру не знайдено
          </ui-select-no-choice>
        </ui-select>
      </div>
      <div class="speciality-select">
        <label for="speciality" class="select-form__label">Спеціальність</label>
        <ui-select id="speciality" class="select-form__select_attest" ng-model="specialities.selected"
                   append-to-body="true"
                   on-select="loadSpecializations(specialities.selected.id);">
          <ui-select-match placeholder="Оберіть спеціальність">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="speciality in (specialities | filter: $select.search)"
                             position="down">
            <span ng-bind="speciality.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Спеціальність не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorSpecialities" class="error-np-messages">
          {{errorSpecialities}}
        </div>
      </div>
      <div class="specialization-select">
        <label for="specialization" class="select-form__label">Спеціалізація</label>
        <ui-select id="specialization" class="select-form__select_attest" ng-model="specializations.selected"
                   append-to-body="true"
                   on-select="reloadNp(specializations.selected.id, studyYears.selected.id, studyForms.selected.id)">
          <ui-select-match placeholder="Оберіть спеціалізацію">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices
            repeat="specialization in (specializations | filter: $select.search) track by specialization.id"
            position="down">
            <span ng-bind="specialization.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Спеціалізацію не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorSpecializations" class="error-np-messages">
          {{errorSpecializations}}
        </div>
      </div>
      <div class="study-year-select">
        <label for="study-year" class="select-form__label">Навчальний рік (рік вступу)</label>
        <ui-select id="study-year" class="select-form__select_attest" ng-model="studyYears.selected"
                   append-to-body="true"
                   on-select="reloadNp(specializations.selected.id, studyYears.selected.id, studyForms.selected.id)">
          <ui-select-match placeholder="Оберіть навчальний рік">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="studyYear in (studyYears | filter: $select.search) track by studyYear.id"
                             position="down">
            <span ng-bind="studyYear.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Навчальний рік не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorStudyYears" class="error-np-messages">
          {{errorStudyYears}}
        </div>
      </div>
      <div class="okr-select">
        <label for="okr" class="select-form__label">ОКР</label>
        <ui-select id="okr" class="select-form__select_attest" ng-model="allOkr.selected" append-to-body="true">
          <ui-select-match placeholder="Оберіть ОКР">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="okr in (allOkr | filter: $select.search)"
                             position="down">
            <span ng-bind="okr.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            ОКР не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorOkr" class="error-np-messages">
          {{errorOkr}}
        </div>
      </div>
      <div class="study-form-select">
        <label for="study-form" class="select-form__label">Форма навчання</label>
        <ui-select id="study-form" class="select-form__select_attest" ng-model="studyForms.selected"
                   append-to-body="true"
                   on-select="reloadNp(specializations.selected.id, studyYears.selected.id, studyForms.selected.id)">
          <ui-select-match placeholder="Оберіть форму навчання">
            <span ng-bind="$select.selected.name"></span>
          </ui-select-match>
          <ui-select-choices repeat="studyForm in (studyForms | filter: $select.search) track by studyForm.id"
                             position="down">
            <span ng-bind="studyForm.name"></span>
          </ui-select-choices>
          <ui-select-no-choice>
            Форму навчання не знайдено
          </ui-select-no-choice>
        </ui-select>
        <div ng-show="errorStudyForms" class="error-np-messages">
          {{errorStudyForms}}
        </div>
      </div>
    </div>

    <div class="col-md-12" id="np-content">
      <div ng-hide="errorNp" class="toggle">
        <button id="filter-toggle" type="button" class="btn btn-primary btn_filter_green btn-filters"
                ng-click="showFilter = !showFilter">
          Показати фільтри
          <span class="glyphicon glyphicon-filter" aria-hidden="true"></span>
        </button>
        <button type="button" class="btn btn-primary btn_filter_green btn-filters"
                ng-click="editable = !editable">
          Редагувати
          <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
        </button>
      </div>

      <div ng-show="errorNp" class="alert alert-danger">
        <p class="text-center">{{errorNp}}</p>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered table-condensed table-hover">
          <caption class="text-center">Навчальний план для спеціалізації</caption>
          <thead>
          <tr class="patterns__table-header color-head">
            <th class="tdFullAlignCenter">№</th>
            <th class="tdFullAlignCenter">Актуальність</th>
            <th class="tdFullAlignCenter">Спеціалізація</th>
            <th class="tdFullAlignCenter">Навчальний рік</th>
            <th class="tdFullAlignCenter">Форма навчання</th>
            <th class="tdFullAlignCenter">Назва</th>
            <th class="tdFullAlignCenter">Дата зміни</th>
            <th class="tdFullAlignCenter">ОКР</th>
            <th class="tdFullAlignCenter">Термін рік</th>
            <th class="tdFullAlignCenter">Термін місяць</th>
            <th class="tdFullAlignCenter" ng-show="editable">Дії з НП</th>
          </tr>
          <tr class="d-s-table patterns__table-button" ng-show="editable">
            <td colspan="11" class="text-center">
              <a class="add-new-np" data-toggle="modal" data-target="#newNp">
                <i class="fa fa-plus" aria-hidden="true"></i>
                Додати новий навчальний план
              </a>
            </td>
          </tr>
          </thead>
          <tbody ng-hide="hideTable === true || npArray.length === 0 || errorNp" >
          <tr ng-repeat="np in npArray=(nps | filter: allOkr.selected.name)">
            <td>{{np.id}}</td>
            <td>
              <span editable-checkbox="np.actuality" e-name="actuality" e-form="npForm">
                <input type="checkbox" ng-disabled="true" ng-model="np.actuality">
                {{showStatus(np.actuality)}}
              </span>
            </td>
            <td>
              <div editable-ui-select="np.specialization" data-e-form="npForm"
                   data-e-append-to-body="true"
                   data-e-name="specialization" name="specialization" theme="bootstrap"
                   data-e-ng-model="np.specialization"
                   onbeforesave="checkSpecialization($data)"
                   data-e-style="width:auto;">
                {{np.specialization.name}}
                <editable-ui-select-match placeholder="Вкажіть спеціалізацію">
                  {{$select.selected.name}}
                </editable-ui-select-match>
                <editable-ui-select-choices
                  repeat="specialization in (specializations | filter: $select.search) track by specialization.id"
                  position="down">
                  {{specialization.name}}
                </editable-ui-select-choices>
              </div>
            </td>
            <td>
              <div editable-ui-select="np.studyingYear" data-e-form="npForm"
                   data-e-append-to-body="true"
                   data-e-name="studyingYear" name="studyingYear" theme="bootstrap"
                   data-e-ng-model="np.studyingYear"
                   onbeforesave="checkStudyYear($data)"
                   data-e-style="width:auto;">
                {{np.studyingYear.name}}
                <editable-ui-select-match placeholder="Вкажіть навчальний рік">
                  {{$select.selected.name}}
                </editable-ui-select-match>
                <editable-ui-select-choices
                  repeat="studyYear in (studyYears | filter: $select.search) track by studyYear.id"
                  position="down">
                  {{studyYear.name}}
                </editable-ui-select-choices>
              </div>
            </td>
            <td>
              <div editable-ui-select="np.studyForm" data-e-form="npForm"
                   data-e-append-to-body="true"
                   data-e-name="studyForm" name="studyForm" theme="bootstrap"
                   data-e-ng-model="np.studyForm"
                   data-e-style="width:auto;">
                {{np.studyForm.name}}
                <editable-ui-select-match placeholder="Вкажіть навчальний рік">
                  {{$select.selected.name}}
                </editable-ui-select-match>
                <editable-ui-select-choices
                  repeat="studyForm in (studyForms | filter: $select.search) track by studyForm.id"
                  position="down">
                  {{studyForm.name}}
                </editable-ui-select-choices>
              </div>
            </td>
            <td>
              <span onbeforesave="checkName($data)" editable-text="np.name" e-name="name" e-form="npForm">
               {{ np.name || 'empty' }}
              </span>
            </td>
            <td>{{np.changeDate}}</td>
            <td>
              <div editable-ui-select="np.okr" data-e-form="npForm"
                   data-e-append-to-body="true"
                   data-e-name="okr" name="okr" theme="bootstrap"
                   data-e-ng-model="np.okr"
                   onbeforesave="checkOkr($data)"
                   data-e-style="width:auto;">
                {{np.okr.name}}
                <editable-ui-select-match placeholder="Вкажіть окр">
                  {{$select.selected.name}}
                </editable-ui-select-match>
                <editable-ui-select-choices
                  repeat="okr in (allOkr | filter: $select.search)"
                  position="down">
                  {{okr.name}}
                </editable-ui-select-choices>
              </div>
            </td>
            <td>
              <span editable-number="np.studyTermYear" e-name="studyTermYear" e-form="npForm" e-min="0" e-max="4">
                {{np.studyTermYear}}
              </span>
            </td>
            <td>
              <span editable-number="np.studyTermMonth" e-name="studyTermMonth" e-form="npForm" e-min="0" e-max="12">
                {{np.studyTermMonth}}
              </span>
            </td>
            <td ng-show="editable">
              <!-- form -->
              <form editable-form name="npForm" ng-show="npForm.$visible" onbeforesave="editNp(np.id, $data);"
                    class="form-buttons form-inline">
                <button type="submit" class="btn patterns__table-button patterns__table-button_CRUD-button"
                        ng-disabled="npForm.$waiting">
                  <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn patterns__table-button patterns__table-button_CRUD-button"
                        ng-click="npForm.$cancel()"
                        ng-disabled="npForm.$waiting">
                  <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                </button>
              </form>
              <div class="buttons" ng-show="!npForm.$visible">
                <button type="button" class="btn patterns__table-button patterns__table-button_CRUD-button"
                        ng-click="npForm.$show()">
                  <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                </button>
                <button type="button" class="btn patterns__table-button patterns__table-button_CRUD-button"
                        ng-click="deleteNp(np.id)">
                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <div ng-show="hideTable === true || npArray.length === 0" class="alert alert-warning">
        на жаль НП з такими параметрами не існує
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="newNp" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Створення нового НП</h4>
          </div>
          <div class="modal-body">
            <p>Обов'язкові для заповнення поля</p>
            <div class="form-group">
              <label class="select-form__label" for="npName">Назва НП</label>
              <input class="form-control" type="text" id="npName" ng-model="npName"
                     required placeholder="Введіть назву навчального плану">

              <div class="np-studying-year-modal">
                <label for="np-studying-year" class="select-form__label">Навчальний рік</label>
                <ui-select id="np-studying-year" class="select-form__select_attest"
                           ng-model="studyYearsModal.selected">
                  <ui-select-match placeholder="Вкажіть навчальний рік">
                    <span ng-bind="$select.selected.name"></span>
                  </ui-select-match>
                  <ui-select-choices
                    repeat="studyYearModal in (studyYearsModal | filter: $select.search) track by studyYearModal.id"
                    position="down">
                    <span ng-bind="studyYearModal.name"></span>
                  </ui-select-choices>
                  <ui-select-no-choice>
                    Навчальний рік не знайдено
                  </ui-select-no-choice>
                </ui-select>
                <div ng-show="errorStudyYears" class="error-np-messages">
                  {{errorStudyYears}}
                </div>
              </div>

              <div class="np-specialization-modal">
                <label for="np-specialization" class="select-form__label">Спеціалізація</label>
                <ui-select id="np-specialization" class="select-form__select_attest"
                           ng-model="specializationsModal.selected">
                  <ui-select-match placeholder="Вкажіть спеціалізацію">
                    <span ng-bind="$select.selected.name"></span>
                  </ui-select-match>
                  <ui-select-choices
                    repeat="specModal in (specializationsModal | filter: $select.search) track by specModal.id"
                    position="down">
                    <span ng-bind="specModal.name"></span>
                  </ui-select-choices>
                  <ui-select-no-choice>
                    Спеціалізацію не знайдено
                  </ui-select-no-choice>
                </ui-select>
                <div ng-show="errorSpecializations" class="error-np-messages">
                  {{errorSpecializations}}
                </div>
              </div>

              <div class="np-study-form-modal">
                <label for="np-study-form" class="select-form__label">Форма навчання</label>
                <ui-select id="np-study-form" class="select-form__select_attest" ng-model="studyFormsModal.selected">
                  <ui-select-match placeholder="Вкажіть форму навчання">
                    <span ng-bind="$select.selected.name"></span>
                  </ui-select-match>
                  <ui-select-choices repeat="studyFormModal in (studyFormsModal | filter: $select.search) track by studyFormModal.id"
                                     position="down">
                    <span ng-bind="studyFormModal.name"></span>
                  </ui-select-choices>
                  <ui-select-no-choice>
                    Форму навчання не знайдено
                  </ui-select-no-choice>
                </ui-select>
                <div ng-show="errorStudyForms" class="error-np-messages">
                  {{errorStudyForms}}
                </div>
              </div>

              <label class="select-form__label" for="StudyTermYear">Термін РІК</label>
              <input class="form-control" ng-model="StudyTermYear" type="number" id="studyTermYear" min="0" max="4"
                     required placeholder="Вкажіть кількості років для НП">

              <label class="select-form__label" for="StudyTermMonth">Термін Місяць</label>
              <input class="form-control" ng-model="StudyTermMonth" type="number" id="studyTermMonth" min="0" max="12"
                     required placeholder="Вкажіть кількості місяців для НП">
            </div>
            <a ng-click="showAdditionalFiels = !showAdditionalFiels">
              Показати додаткові поля
            </a>
            <div ng-show="showAdditionalFiels">
              <div class="okr-modal">
                <label for="okr-modal" class="select-form__label">ОКР</label>
                <ui-select id="okr-modal" ng-model="allOkrsModal.selected">
                  <ui-select-match placeholder="Оберіть ОКР">
                    <span ng-bind="$select.selected.name"></span>
                  </ui-select-match>
                  <ui-select-choices repeat="allOkrModal in (allOkrsModal | filter: $select.search)"
                                     position="down">
                    <span ng-bind="allOkrModal.name"></span>
                  </ui-select-choices>
                  <ui-select-no-choice>
                    ОКР не знайдено
                  </ui-select-no-choice>
                </ui-select>
                <div ng-show="errorOkr" class="error-np-messages">
                  {{errorOkr}}
                </div>
              </div>
              <div>
                <label for="actuality" class="select-form__label">Актуальність</label>
                <input id="actuality" type="checkbox" ng-model="npActuality">
              </div>
              <div>
                <label for="protocolNumber" class="select-form__label">Номер протоколу</label>
                <input id="protocolNumber" type="number" ng-model="npProtocolNumber">
              </div>
              <div>
                <label for="protocolDate" class="select-form__label">Дату прийняття протоколу</label>
                <input id="protocolDate" type="datetime-local" ng-model="npProtocolDate">
              </div>
            </div>
            <h4 class="text-center">Ви створюєте НП з наступними параметрами</h4>
            <p ng-show="npName">Назва - {{npName}}</p>
            <p ng-show="studyYearsModal.selected.name">Навч рік - {{studyYearsModal.selected.name}}</p>
            <p ng-show="specializationsModal.selected.name">Спеціаліз - {{specializationsModal.selected.name}}</p>
            <p ng-show="studyFormsModal.selected.name">Форма навч - {{studyFormsModal.selected.name}}</p>
            <p ng-show="StudyTermYear">Термін рік - {{StudyTermYear}}</p>
            <p ng-show="StudyTermMonth">Термін місяць - {{StudyTermMonth}}</p>
            <p ng-show="allOkrsModal.selected.name">ОКР - {{allOkrsModal.selected.name}}</p>
            <p>Актуальність - {{showStatus(npActuality)}}</p>
            <p ng-show="npProtocolNumber">Номер протоколу - {{npProtocolNumber}}</p>
            <p ng-show="npProtocolDate">Дату прийняття протоколу - {{npProtocolDate}}</p>
          </div>
          <div ng-show="addNewNpResults" class="alert alert-info">
            {{addNewNpResults}}
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary btn-np pull-left"
                    ng-click="addNewNp(createPayloadForSave(
                    specializationsModal.selected.id, studyYears.selected.id, studyForms.selected.id,
                    StudyTermYear, StudyTermMonth, npName, allOkrsModal.selected.id, npActuality,
                    npProtocolNumber, npProtocolDate))">
              Зберегти
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">Закрити</button>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
